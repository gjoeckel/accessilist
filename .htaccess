Options -MultiViews

<IfModule mod_rewrite.c>
  RewriteEngine On

  # No RewriteBase - Apache auto-determines from .htaccess location
  # Works for both root (/) and subdirectory (/training/online/accessilist/) deployments

  # Allow direct access to existing files and directories
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # --- Clean URL Routes (IMPORTANT: Specific routes must come before general patterns) ---
  # These provide user-friendly URLs without /php/ prefix or .php extension

  # Home page: /home → /php/home.php
  RewriteRule ^home/?$ php/home.php [L]

  # Admin page: /admin → /php/admin.php
  RewriteRule ^admin/?$ php/admin.php [L]

  # --- API Routes: extensionless to .php (preserve method) ---
  # Matches /php/api/save → /php/api/save.php (and similarly for restore, list, delete, health)
  RewriteRule ^php/api/([^/.]+)$ php/api/$1.php [L]

  # --- General PHP Routes: extensionless to .php for files under /php ---
  # This is the catch-all pattern and must come LAST
  RewriteRule ^php/([^/.]+)$ php/$1.php [L]

  # Fallback: do nothing special; rely on actual files or above rules
</IfModule>

<IfModule mod_headers.c>
  # Disable caching for dynamic content during development
  <FilesMatch "\.(php)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# Disable caching for all files
<IfModule mod_headers.c>
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
    Header unset ETag
    FileETag None
</IfModule>

# Force browsers to revalidate
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access"
</IfModule>
