# AccessiList - List Report

**Document Type:** Backend Developer Code Audit Reference
**Last Updated:** October 20, 2025
**Purpose:** Individual checklist detailed report documentation
**Branch:** cleanup-and-scope-server-files

---

## üìã Overview

The List Report (`/list-report?session=XXX`) displays a detailed view of a single saved checklist with all tasks grouped by checkpoint, showing task text, status, notes, and update timestamps.

### Key Features
- **Single Checklist View** - Detailed report for one session
- **Checkpoint Grouping** - Tasks organized by checkpoint sections
- **Status Indicators** - Visual status badges (Done, Active, Ready)
- **Notes Display** - Read-only scrollable textareas with task notes
- **Progress Tracking** - Done tasks / Total tasks per checkpoint
- **Interactive Filtering** - Filter by status (Done, Active)
- **Back Navigation** - Return to checklist or systemwide report

### Technical Stack
- **Page:** `php/list-report.php`
- **JavaScript:** `js/list-report.js`
- **CSS:** `css/list-report.css`
- **API:** `/php/api/restore?sessionKey=XXX` (provides full session data)

---

## üèóÔ∏è Architecture

### Page Structure: `php/list-report.php`

```php
<body class="report-page list-report-page">
  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div id="loadingSpinner"></div>
    <div id="loadingText">Loading report...</div>
  </div>

  <!-- Side Panel - Checkpoint Navigation -->
  <nav class="side-panel" aria-expanded="true">
    <ul id="checkpoint-nav">
      <!-- Checkpoint buttons generated by list-report.js -->
    </ul>
    <button class="toggle-strip" aria-label="Toggle side panel">
      <span class="toggle-arrow">‚óÄ</span>
    </button>
  </nav>

  <!-- Sticky Header with Filters -->
  <header class="sticky-header">
    <h1>List Report</h1>

    <!-- Filter Buttons -->
    <div class="filter-buttons" role="group" aria-label="Filter tasks by status">
      <button class="filter-button active" data-filter="all">
        All (<span class="count-all">0</span>)
      </button>
      <button class="filter-button" data-filter="done">
        Done (<span class="count-done">0</span>)
      </button>
      <button class="filter-button" data-filter="active">
        Active (<span class="count-active">0</span>)
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="header-buttons-group">
      <button id="backButton">Back to Checklist</button>
      <button id="refreshButton">Refresh</button>
    </div>
  </header>

  <!-- Main Content -->
  <main role="main">
    <div class="report-section">
      <!-- Checkpoint sections generated by list-report.js -->
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <p>Accessibility Checklists</p>
  </footer>
</body>
```

---

## üíæ Data Flow

### 1. Page Load
```
User navigates to /list-report?session=A4K
  ‚Üì
Page loads with empty report section
  ‚Üì
JavaScript extracts session key from URL
  ‚Üì
Fetch /php/api/restore?sessionKey=A4K
  ‚Üì
Server returns complete session data:
  - sessionKey
  - typeSlug
  - metadata (created, lastModified)
  - state (statusButtons, textareas)
  ‚Üì
Load checklist template (JSON)
  ‚Üì
Build report structure:
  - Group tasks by checkpoint
  - Merge template + saved state
  - Create checkpoint sections
  - Create task rows
  ‚Üì
Render to DOM
  ‚Üì
Build side panel navigation
  ‚Üì
Update filter counts
  ‚Üì
Apply default filter (All)
```

### 2. Filter Interaction
```
User clicks filter button (e.g., "Done")
  ‚Üì
Update active filter button
  ‚Üì
Show/hide task rows based on status
  ‚Üì
Hide checkpoints with no visible tasks
  ‚Üì
Update scroll buffer
  ‚Üì
Update side panel (hide/show checkpoint buttons)
```

### 3. Checkpoint Navigation
```
User clicks checkpoint button in side panel
  ‚Üì
Scroll to checkpoint section
  ‚Üì
Focus checkpoint heading
  ‚Üì
Highlight active checkpoint button
```

---

## üìä Report Structure

### Checkpoint Section

```html
<section class="report-checkpoint" data-checkpoint="1">
  <h2 id="checkpoint-1-caption" class="report-checkpoint-heading" tabindex="-1">
    Checkpoint 1: Accessibility Basics
  </h2>

  <div class="checkpoint-summary">
    <span class="checkpoint-progress">
      Progress: <strong>2 / 4</strong> tasks done (50%)
    </span>
  </div>

  <table class="report-table">
    <caption class="sr-only">Tasks for Checkpoint 1</caption>
    <thead>
      <tr>
        <th scope="col" class="task-cell">Task</th>
        <th scope="col" class="status-cell">Status</th>
        <th scope="col" class="notes-cell">Notes</th>
      </tr>
    </thead>
    <tbody>
      <!-- Task rows -->
    </tbody>
  </table>
</section>
```

### Task Row

```html
<tr class="report-row" data-task-id="0" data-status="done">
  <td class="task-cell">
    <span class="task-text">Use proper heading structure</span>
  </td>
  <td class="status-cell">
    <span class="status-badge status-done">Done</span>
  </td>
  <td class="notes-cell">
    <textarea
      class="notes-display"
      readonly
      tabindex="-1"
      aria-label="Notes for task: Use proper heading structure"
    >Implemented H1-H6 hierarchy throughout document</textarea>
  </td>
</tr>
```

---

## üîç JavaScript Implementation: `js/list-report.js`

### Data Processing

```javascript
async function loadReportData() {
  // Extract session key from URL
  const urlParams = new URLSearchParams(window.location.search);
  const sessionKey = urlParams.get('session');

  if (!sessionKey) {
    showError('Invalid Session Key: No session specified');
    return;
  }

  try {
    // Fetch saved session data
    const response = await fetch(`/php/api/restore?sessionKey=${sessionKey}`);
    const result = await response.json();

    if (!result.success) {
      showError(result.message || 'Failed to load session');
      return;
    }

    const sessionData = result.data;

    // Load checklist template
    const templatePath = getTemplatePath(sessionData.typeSlug);
    const templateResponse = await fetch(templatePath);
    const template = await templateResponse.json();

    // Build report
    buildReport(template, sessionData);

  } catch (error) {
    console.error('Error loading report:', error);
    showError('Failed to load report data');
  }
}

function buildReport(template, sessionData) {
  const reportSection = document.querySelector('.report-section');
  reportSection.innerHTML = '';

  template.checkpoints.forEach((checkpoint, checkpointIndex) => {
    const section = createCheckpointSection(
      checkpoint,
      checkpointIndex + 1,
      sessionData.state
    );
    reportSection.appendChild(section);
  });

  buildSidePanelNavigation(template.checkpoints.length);
  updateFilterCounts();
  hideLoadingOverlay();
}
```

### Checkpoint Section Builder

```javascript
function createCheckpointSection(checkpoint, checkpointNumber, state) {
  const section = document.createElement('section');
  section.className = 'report-checkpoint';
  section.dataset.checkpoint = checkpointNumber;

  // Heading
  const heading = document.createElement('h2');
  heading.id = `checkpoint-${checkpointNumber}-caption`;
  heading.className = 'report-checkpoint-heading';
  heading.tabIndex = -1;
  heading.textContent = `Checkpoint ${checkpointNumber}: ${checkpoint.checkpointTitle}`;

  // Progress summary
  const progress = calculateCheckpointProgress(checkpoint.tasks, state);
  const summary = document.createElement('div');
  summary.className = 'checkpoint-summary';
  summary.innerHTML = `
    <span class="checkpoint-progress">
      Progress: <strong>${progress.done} / ${progress.total}</strong> tasks done
      (${progress.percentage}%)
    </span>
  `;

  // Table
  const table = createReportTable(checkpoint.tasks, state);

  section.appendChild(heading);
  section.appendChild(summary);
  section.appendChild(table);

  return section;
}
```

### Task Row Builder

```javascript
function createTaskRow(task, taskId, state) {
  const row = document.createElement('tr');
  row.className = 'report-row';
  row.dataset.taskId = taskId;

  // Get saved status and notes
  const status = state.statusButtons?.[taskId] || 'ready';
  const notes = state.textareas?.[taskId] || '';

  row.dataset.status = status;

  // Task cell
  const taskCell = document.createElement('td');
  taskCell.className = 'task-cell';
  taskCell.innerHTML = `<span class="task-text">${task.task}</span>`;

  // Status cell
  const statusCell = document.createElement('td');
  statusCell.className = 'status-cell';
  statusCell.innerHTML = `<span class="status-badge status-${status}">${formatStatus(status)}</span>`;

  // Notes cell with read-only scrollable textarea
  const notesCell = document.createElement('td');
  notesCell.className = 'notes-cell';

  const textarea = document.createElement('textarea');
  textarea.className = 'notes-display';
  textarea.readOnly = true;
  textarea.tabIndex = -1;
  textarea.setAttribute('aria-label', `Notes for task: ${task.task}`);
  textarea.value = notes;

  notesCell.appendChild(textarea);

  row.appendChild(taskCell);
  row.appendChild(statusCell);
  row.appendChild(notesCell);

  return row;
}
```

---

## üéØ Filtering System

### Filter Implementation

```javascript
function setupFilters() {
  const filterButtons = document.querySelectorAll('.filter-button');

  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Update active button
      filterButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');

      // Get filter value
      const filterValue = this.dataset.filter;

      // Filter rows and checkpoints
      filterReport(filterValue);

      // Update scroll buffer
      if (window.ScrollManager) {
        window.ScrollManager.scheduleReportBufferUpdate();
      }
    });
  });
}

function filterReport(filter) {
  const checkpoints = document.querySelectorAll('.report-checkpoint');

  checkpoints.forEach(checkpoint => {
    const rows = checkpoint.querySelectorAll('.report-row');
    let visibleRowCount = 0;

    rows.forEach(row => {
      const rowStatus = row.dataset.status;

      if (filter === 'all') {
        row.style.display = '';
        visibleRowCount++;
      } else if (rowStatus === filter) {
        row.style.display = '';
        visibleRowCount++;
      } else {
        row.style.display = 'none';
      }
    });

    // Hide checkpoint if no visible rows
    checkpoint.style.display = visibleRowCount > 0 ? 'block' : 'none';
  });

  // Update side panel (hide/show checkpoint buttons)
  updateSidePanelVisibility();
}
```

### Filter States
- **All** - Show all tasks
- **Done** - Show only completed tasks
- **Active** - Show only in-progress tasks (includes both active and partial-done)

---

## üß≠ Side Panel Navigation

### Side Panel Builder

```javascript
function buildSidePanelNavigation(checkpointCount) {
  const nav = document.getElementById('checkpoint-nav');
  nav.innerHTML = '';

  for (let i = 1; i <= checkpointCount; i++) {
    const li = document.createElement('li');
    const button = document.createElement('button');

    button.className = 'checkpoint-nav-button';
    button.textContent = i;
    button.dataset.checkpoint = i;
    button.setAttribute('aria-label', `Go to Checkpoint ${i}`);

    button.addEventListener('click', function() {
      scrollToCheckpoint(i);
    });

    li.appendChild(button);
    nav.appendChild(li);
  }
}

function scrollToCheckpoint(checkpointNumber) {
  const checkpoint = document.querySelector(
    `.report-checkpoint[data-checkpoint="${checkpointNumber}"]`
  );

  if (checkpoint && checkpoint.style.display !== 'none') {
    const heading = checkpoint.querySelector('.report-checkpoint-heading');
    if (heading) {
      heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
      heading.focus();
    }
  }
}
```

---

## üìù Read-Only Scrollable Textareas

### Purpose
Display task notes in read-only, scrollable textareas that allow scrolling but prevent editing and are excluded from tab order.

### Implementation

```css
/* css/list-report.css */
.notes-display {
  width: 100%;
  min-height: 60px;
  max-height: 200px;
  overflow-y: auto;
  resize: vertical;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-family: inherit;
  font-size: 0.875rem;
  line-height: 1.4;
  background-color: #f9f9f9;

  /* Read-only attributes */
  pointer-events: auto; /* Allow scrolling */
  cursor: default;
}

.notes-display:focus {
  outline: none; /* No focus indicator for read-only */
}

/* Scrollbar styling for better UX */
.notes-display::-webkit-scrollbar {
  width: 8px;
}

.notes-display::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.notes-display::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.notes-display::-webkit-scrollbar-thumb:hover {
  background: #555;
}
```

### HTML Attributes

```html
<textarea
  class="notes-display"
  readonly                    <!-- Prevents editing -->
  tabindex="-1"               <!-- Excludes from tab order -->
  aria-label="Notes for task: ..."  <!-- Screen reader description -->
>Task notes content here...</textarea>
```

### Accessibility Features
- **readOnly (not disabled)** - Allows copy/paste, screen reader access
- **tabindex="-1"** - Excluded from keyboard navigation
- **aria-label** - Descriptive label for screen readers
- **Scrollable** - Long notes can be scrolled

---

## üìä Progress Calculation

### Checkpoint Progress

```javascript
function calculateCheckpointProgress(tasks, state) {
  const total = tasks.length;
  let done = 0;

  tasks.forEach((task, index) => {
    const status = state.statusButtons?.[index];
    if (status === 'done') {
      done++;
    }
  });

  const percentage = total > 0 ? Math.round((done / total) * 100) : 0;

  return { done, total, percentage };
}
```

### Overall Progress

```javascript
function calculateOverallProgress(template, state) {
  let totalTasks = 0;
  let doneTasks = 0;

  template.checkpoints.forEach(checkpoint => {
    totalTasks += checkpoint.tasks.length;

    checkpoint.tasks.forEach((task, index) => {
      const status = state.statusButtons?.[index];
      if (status === 'done') {
        doneTasks++;
      }
    });
  });

  const percentage = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;

  return { done: doneTasks, total: totalTasks, percentage };
}
```

---

## üîó Navigation

### Back Button

```javascript
document.getElementById('backButton').addEventListener('click', function() {
  const sessionKey = new URLSearchParams(window.location.search).get('session');
  const typeSlug = getCurrentTypeSlug();

  // Navigate back to checklist
  window.location.href = `/list?type=${typeSlug}&session=${sessionKey}`;
});
```

### Refresh Button

```javascript
document.getElementById('refreshButton').addEventListener('click', function() {
  // Reload current page
  window.location.reload();
});
```

---

## üé® Status Badges

### CSS Styling

```css
.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-badge.status-done {
  background-color: #4CAF50;
  color: #fff;
}

.status-badge.status-active {
  background-color: #FFC107;
  color: #000;
}

.status-badge.status-ready {
  background-color: #9E9E9E;
  color: #fff;
}
```

---

## ‚ö†Ô∏è Error Handling

### Invalid Session Key

```javascript
if (!sessionKey || sessionKey.trim() === '') {
  showError('Invalid Session Key: No session specified');
  return;
}
```

### Session Not Found

```javascript
if (response.status === 404) {
  showError('Session Not Found: The requested session does not exist');
  return;
}
```

### Invalid Session Format

```javascript
if (!sessionKey.match(/^[a-zA-Z0-9\-]{3,20}$/)) {
  showError('Invalid Session Key: Malformed session key format');
  return;
}
```

---

## üß™ Testing

### Test Coverage

From `proj-test-mirror` (13 list report tests):
- ‚úÖ Valid session handling (HTTP 200)
- ‚úÖ Heading and JS module loading
- ‚úÖ CSS file loading
- ‚úÖ Filter functionality
- ‚úÖ Table structure
- ‚úÖ Back and Refresh buttons
- ‚úÖ Invalid session handling
- ‚úÖ Missing/malformed parameters
- ‚úÖ Filter labels
- ‚úÖ Read-only textarea configuration
- ‚úÖ Scrollbar styling
- ‚úÖ Checkpoint navigation

### Manual Testing Checklist

1. Load `/list-report?session=VALID`
2. Verify all checkpoints displayed
3. Verify task statuses match saved data
4. Verify notes displayed correctly
5. Test filters (All, Done, Active)
6. Test checkpoint navigation
7. Test Back button ‚Üí returns to checklist
8. Test Refresh button ‚Üí reloads data
9. Test with invalid session ‚Üí shows error
10. Test with missing parameter ‚Üí shows error
11. Test read-only textarea scrolling
12. Test keyboard navigation
13. Test screen reader compatibility

---

## üìö Related Documentation

- **[GENERAL-ARCHITECTURE.md](GENERAL-ARCHITECTURE.md)** - System overview
- **[SAVE-AND-RESTORE.md](SAVE-AND-RESTORE.md)** - Restore API endpoint
- **[LIST-USER-INTERFACE.md](LIST-USER-INTERFACE.md)** - UI components
- **[SYSTEMWIDE-REPORT.md](SYSTEMWIDE-REPORT.md)** - Aggregate dashboard (links to this page)
- **[TESTING.md](TESTING.md)** - List report test coverage

---

*Document Created: October 20, 2025*
*Synthesized from: user-report-page.md (1494 lines)*
*Status: Complete individual checklist report documentation*
