# AccessiList - Systemwide Report

**Document Type:** Backend Developer Code Audit Reference
**Last Updated:** October 20, 2025
**Purpose:** Systemwide aggregate reporting dashboard documentation
**Branch:** cleanup-and-scope-server-files

---

## üìã Overview

The Systemwide Report (`/systemwide-report`) is an aggregate dashboard displaying all saved checklist sessions with real-time status calculation (Done, Active, Ready), progress tracking, and interactive filtering.

### Key Features
- **Aggregate View** - All saved checklists in one dashboard
- **Real-Time Status** - Client-side status calculation from state data
- **Progress Tracking** - Done tasks / Total tasks for each checklist
- **Interactive Filtering** - Filter by status (Done, Active, Not Started)
- **Sortable Table** - Sort by session key, type, date, status, progress
- **Clickable Links** - Navigate to individual list reports

### Technical Stack
- **Page:** `php/systemwide-report.php`
- **JavaScript:** `js/systemwide-report.js`
- **CSS:** `css/systemwide-report.css`
- **API:** `/php/api/list-detailed` (provides full state for status calculation)

---

## üèóÔ∏è Architecture

### Page Structure: `php/systemwide-report.php`

```php
<body class="report-page systemwide-report-page">
  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div id="loadingSpinner"></div>
    <div id="loadingText">Loading reports...</div>
  </div>

  <!-- Sticky Header with Filters -->
  <header class="sticky-header">
    <h1>Systemwide Report</h1>

    <!-- Filter Buttons -->
    <div class="filter-buttons" role="group" aria-label="Filter reports by status">
      <button class="filter-button active" data-filter="all">
        All (<span class="count-all">0</span>)
      </button>
      <button class="filter-button" data-filter="done">
        Done (<span class="count-done">0</span>)
      </button>
      <button class="filter-button" data-filter="active">
        Active (<span class="count-active">0</span>)
      </button>
      <button class="filter-button" data-filter="ready">
        Not Started (<span class="count-ready">0</span>)
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="header-buttons-group">
      <button id="refreshButton">Refresh</button>
      <button id="homeButton">Home</button>
    </div>
  </header>

  <!-- Main Content -->
  <main role="main">
    <div class="report-section">
      <table class="reports-table">
        <caption class="reports-caption">All Saved Checklists</caption>
        <thead>
          <tr>
            <th scope="col" class="session-cell">Session</th>
            <th scope="col" class="type-cell">Type</th>
            <th scope="col" class="date-cell">Date</th>
            <th scope="col" class="status-cell">Status</th>
            <th scope="col" class="task-cell">Progress</th>
          </tr>
        </thead>
        <tbody id="reportsTableBody">
          <!-- Rows generated by systemwide-report.js -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <p>Accessibility Checklists</p>
  </footer>
</body>
```

---

## üíæ Data Flow

### 1. Page Load
```
User navigates to /systemwide-report
  ‚Üì
Page loads with empty table
  ‚Üì
JavaScript initializes
  ‚Üì
Fetch /php/api/list-detailed
  ‚Üì
Server returns all sessions with full state
  ‚Üì
Client-side status calculation:
  - Count Done, Active, Ready tasks
  - Determine overall session status
  - Calculate progress percentage
  ‚Üì
Render table rows
  ‚Üì
Update filter counts
  ‚Üì
Apply default filter (All)
```

### 2. Filter Interaction
```
User clicks filter button (e.g., "Done")
  ‚Üì
Update active filter button
  ‚Üì
Show/hide table rows based on status
  ‚Üì
Update scroll buffer (dynamic positioning)
  ‚Üì
Maintain table accessibility
```

### 3. Refresh
```
User clicks Refresh button
  ‚Üì
Show loading overlay
  ‚Üì
Re-fetch /php/api/list-detailed
  ‚Üì
Recalculate all statuses
  ‚Üì
Re-render table
  ‚Üì
Hide loading overlay
```

---

## üìä Status Calculation Logic

### JavaScript Implementation: `js/systemwide-report.js`

```javascript
function calculateSessionStatus(state) {
  if (!state || !state.statusButtons) {
    return 'ready'; // No state = Not Started
  }

  const statuses = Object.values(state.statusButtons);
  const totalTasks = statuses.length;

  if (totalTasks === 0) {
    return 'ready';
  }

  const doneTasks = statuses.filter(s => s === 'done').length;
  const activeTasks = statuses.filter(s => s === 'active').length;

  // All tasks done = Done
  if (doneTasks === totalTasks) {
    return 'done';
  }

  // Any task active = Active
  if (activeTasks > 0) {
    return 'active';
  }

  // Any task done but not all = Active
  if (doneTasks > 0 && doneTasks < totalTasks) {
    return 'active';
  }

  // No tasks started = Not Started
  return 'ready';
}

function calculateProgress(state) {
  if (!state || !state.statusButtons) {
    return { done: 0, total: 0, percentage: 0 };
  }

  const statuses = Object.values(state.statusButtons);
  const total = statuses.length;
  const done = statuses.filter(s => s === 'done').length;
  const percentage = total > 0 ? Math.round((done / total) * 100) : 0;

  return { done, total, percentage };
}
```

### Status Rules

| Condition | Status |
|-----------|--------|
| All tasks = done | **Done** |
| Any task = active | **Active** |
| Some tasks = done (but not all) | **Active** |
| No tasks started (all = ready) | **Not Started** (ready) |
| No state data | **Not Started** (ready) |

---

## üé® Table Rendering

### Row Generation

```javascript
function renderReportsTable(sessions) {
  const tbody = document.getElementById('reportsTableBody');
  tbody.innerHTML = '';

  // Sort by timestamp (newest first)
  sessions.sort((a, b) => b.timestamp - a.timestamp);

  sessions.forEach(session => {
    const status = calculateSessionStatus(session.state);
    const progress = calculateProgress(session.state);
    const typeDisplay = TypeManager.formatDisplayName(session.typeSlug);
    const dateDisplay = formatDate(session.created);

    const row = document.createElement('tr');
    row.className = `report-row status-${status}`;
    row.dataset.status = status;
    row.dataset.sessionKey = session.sessionKey;

    row.innerHTML = `
      <td class="session-cell">
        <a href="/list-report?session=${session.sessionKey}">
          ${session.sessionKey}
        </a>
      </td>
      <td class="type-cell">${typeDisplay}</td>
      <td class="date-cell">${dateDisplay}</td>
      <td class="status-cell">
        <span class="status-badge status-${status}">
          ${formatStatus(status)}
        </span>
      </td>
      <td class="task-cell">
        <span class="progress-text">
          ${progress.done} / ${progress.total}
        </span>
        <span class="progress-percentage">
          (${progress.percentage}%)
        </span>
      </td>
    `;

    tbody.appendChild(row);
  });

  updateFilterCounts(sessions);
}
```

### Filter Counts Update

```javascript
function updateFilterCounts(sessions) {
  const counts = {
    all: sessions.length,
    done: 0,
    active: 0,
    ready: 0
  };

  sessions.forEach(session => {
    const status = calculateSessionStatus(session.state);
    counts[status]++;
  });

  // Update count displays
  document.querySelector('.count-all').textContent = counts.all;
  document.querySelector('.count-done').textContent = counts.done;
  document.querySelector('.count-active').textContent = counts.active;
  document.querySelector('.count-ready').textContent = counts.ready;
}
```

---

## üéØ Filtering System

### Filter Implementation

```javascript
function setupFilters() {
  const filterButtons = document.querySelectorAll('.filter-button');

  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Update active button
      filterButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');

      // Get filter value
      const filterValue = this.dataset.filter;

      // Filter rows
      filterReports(filterValue);

      // Update scroll buffer
      if (window.ScrollManager) {
        window.ScrollManager.scheduleReportBufferUpdate();
      }
    });
  });
}

function filterReports(filter) {
  const rows = document.querySelectorAll('.report-row');

  rows.forEach(row => {
    if (filter === 'all') {
      row.style.display = '';
    } else {
      const rowStatus = row.dataset.status;
      row.style.display = rowStatus === filter ? '' : 'none';
    }
  });
}
```

### Filter States
- **All** - Show all sessions
- **Done** - Show only completed sessions
- **Active** - Show only in-progress sessions
- **Not Started** - Show only ready (untouched) sessions

---

## üìÖ Date Formatting

### Implementation

```javascript
function formatDate(timestamp) {
  const date = new Date(timestamp);
  const options = {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  return date.toLocaleDateString('en-US', options);
}

// Example output: "Oct 20, 2025, 01:30 PM"
```

---

## üé® Status Badges

### CSS Styling: `css/systemwide-report.css`

```css
/* Status Badges */
.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.875rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-badge.status-done {
  background-color: #4CAF50;
  color: #fff;
}

.status-badge.status-active {
  background-color: #FFC107;
  color: #000;
}

.status-badge.status-ready {
  background-color: #9E9E9E;
  color: #fff;
}

/* Row Highlighting */
.report-row.status-done {
  background-color: #E8F5E9;
}

.report-row.status-active {
  background-color: #FFF9E6;
}

.report-row.status-ready {
  background-color: #F5F5F5;
}
```

---

## üîó Navigation

### Session Links

Each session key is a clickable link to the detailed list report:

```html
<a href="/list-report?session=${sessionKey}">
  ${sessionKey}
</a>
```

**Destination:** `/list-report?session=A4K` ‚Üí Detailed single-checklist report

### Header Buttons

- **Refresh** - Reload data from API
- **Home** - Navigate to `/home` (checklist type selection)

---

## ‚ö° Performance Optimization

### Client-Side Status Calculation

**Why:** Avoids complex server-side calculations and database queries

**How:**
1. Fetch full state data once (`/php/api/list-detailed`)
2. Calculate status client-side for all sessions
3. Cache results until refresh

**Trade-off:**
- Larger initial payload (includes state data)
- Faster subsequent filtering (no server round-trips)
- Acceptable for typical usage (< 100 sessions)

### Scroll Buffer Optimization

```javascript
// Only update buffer on filter change (not during scroll)
filterButtons.forEach(button => {
  button.addEventListener('click', function() {
    // ... filter logic ...

    // Update scroll buffer after filtering
    window.ScrollManager.scheduleReportBufferUpdate();
  });
});
```

---

## ‚ôø Accessibility Features

### ARIA Labels

```html
<div class="filter-buttons" role="group" aria-label="Filter reports by status">
  <button class="filter-button active" data-filter="all" aria-pressed="true">
    All (<span class="count-all">15</span>)
  </button>
</div>
```

### Table Semantics

```html
<table class="reports-table">
  <caption class="reports-caption">All Saved Checklists</caption>
  <thead>
    <tr>
      <th scope="col" class="session-cell">Session</th>
      <!-- ... -->
    </tr>
  </thead>
</table>
```

### Keyboard Navigation

- All filters keyboard accessible (Tab, Enter)
- Session links keyboard accessible
- Focus indicators visible (2px outline)

---

## üß™ Testing

### Test Coverage

From `proj-test-mirror` (16 systemwide report tests):
- ‚úÖ Page load verification
- ‚úÖ List-detailed API endpoint
- ‚úÖ JavaScript module loading
- ‚úÖ Filter buttons (Done, Active, Not Started)
- ‚úÖ Reports table structure
- ‚úÖ Status/Progress columns
- ‚úÖ Refresh and Home buttons
- ‚úÖ CSS file loading
- ‚úÖ Caption and section elements
- ‚úÖ Scroll buffer configuration

### Manual Testing Checklist

1. Load `/systemwide-report`
2. Verify all sessions displayed
3. Test each filter (All, Done, Active, Not Started)
4. Verify counts match filtered rows
5. Click session link ‚Üí navigates to list report
6. Click Refresh ‚Üí data reloads
7. Click Home ‚Üí navigates to home page
8. Test keyboard navigation
9. Test with 0 sessions (empty state)
10. Test with 100+ sessions (performance)

---

## üìö Related Documentation

- **[GENERAL-ARCHITECTURE.md](GENERAL-ARCHITECTURE.md)** - System overview
- **[SAVE-AND-RESTORE.md](SAVE-AND-RESTORE.md)** - list-detailed API endpoint
- **[LIST-REPORT.md](LIST-REPORT.md)** - Individual checklist reports (linked from this page)
- **[TESTING.md](TESTING.md)** - Systemwide report test coverage
- **[LIST-USER-INTERFACE.md](LIST-USER-INTERFACE.md)** - UI components

---

*Document Created: October 20, 2025*
*Synthesized from: reports-page.md (870 lines)*
*Status: Complete systemwide reporting dashboard documentation*
