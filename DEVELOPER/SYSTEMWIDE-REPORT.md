# AccessiList - Systemwide Report

**Document Type:** Backend Developer Code Audit Reference
**Last Updated:** October 20, 2025
**Purpose:** Systemwide aggregate reporting dashboard documentation
**Branch:** cleanup-and-scope-server-files

---

## ğŸ“‹ Overview

The Systemwide Report (`/systemwide-report`) is an aggregate dashboard displaying all saved checklist sessions with real-time status calculation (Done, Active, Ready), progress tracking, and interactive filtering.

### Key Features
- **Aggregate View** - All saved checklists in one dashboard
- **Real-Time Status** - Client-side status calculation from state data
- **Progress Tracking** - Done tasks / Total tasks for each checklist
- **Interactive Filtering** - Filter by status (Done, Active, Ready, All, Demos)
- **Sortable Table** - Sort by session key, type, date, status, progress
- **Clickable Links** - Navigate to individual list reports

### Technical Stack
- **Page:** `php/systemwide-report.php`
- **JavaScript:** `js/systemwide-report.js`
- **CSS:** `css/systemwide-report.css`
- **API:** `/php/api/list-detailed` (provides full state for status calculation)

---

## ğŸ—ï¸ Architecture

### Page Structure: `php/systemwide-report.php`

```php
<body class="report-page systemwide-report-page">
  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div id="loadingSpinner"></div>
    <div id="loadingText">Loading reports...</div>
  </div>

  <!-- Sticky Header with Filters -->
  <header class="sticky-header">
    <h1>Systemwide Report</h1>

    <!-- Filter Buttons -->
    <div class="filter-buttons" role="group" aria-label="Filter reports by status">
      <button class="filter-button active" data-filter="all">
        All (<span class="count-all">0</span>)
      </button>
      <button class="filter-button" data-filter="done">
        Done (<span class="count-done">0</span>)
      </button>
      <button class="filter-button" data-filter="active">
        Active (<span class="count-active">0</span>)
      </button>
      <button class="filter-button" data-filter="ready">
        Ready (<span class="count-ready">0</span>)
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="header-buttons-group">
      <button id="refreshButton">Refresh</button>
      <button id="homeButton">Home</button>
    </div>
  </header>

  <!-- Main Content -->
  <main role="main">
    <div class="report-section">
      <table class="reports-table">
        <caption class="reports-caption">All Saved Checklists</caption>
        <thead>
          <tr>
            <th scope="col" class="session-cell">Session</th>
            <th scope="col" class="type-cell">Type</th>
            <th scope="col" class="date-cell">Date</th>
            <th scope="col" class="status-cell">Status</th>
            <th scope="col" class="task-cell">Progress</th>
          </tr>
        </thead>
        <tbody id="reportsTableBody">
          <!-- Rows generated by systemwide-report.js -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <p>Accessibility Checklists</p>
  </footer>
</body>
```

---

## ğŸ’¾ Data Flow

### 1. Page Load
```
User navigates to /systemwide-report
  â†“
Page loads with empty table
  â†“
JavaScript initializes
  â†“
Fetch /php/api/list-detailed
  â†“
Server returns all sessions with full state
  â†“
Client-side status calculation:
  - Count Done, Active, Ready tasks
  - Determine overall session status
  - Calculate progress percentage
  â†“
Render table rows
  â†“
Update filter counts
  â†“
Apply default filter (All)
```

### 2. Filter Interaction
```
User clicks filter button (e.g., "Done")
  â†“
Update active filter button
  â†“
Show/hide table rows based on status
  â†“
Update scroll buffer (dynamic positioning)
  â†“
Maintain table accessibility
```

### 3. Refresh
```
User clicks Refresh button
  â†“
Show loading overlay
  â†“
Re-fetch /php/api/list-detailed
  â†“
Recalculate all statuses
  â†“
Re-render table
  â†“
Hide loading overlay
```

---

## ğŸ“Š Status Calculation Logic

### Algorithm
**File:** `js/systemwide-report.js`

**Status Rules:**
| Condition | Status |
|-----------|--------|
| All tasks = done | **Done** |
| Any task = active | **Active** |
| Some tasks = done (but not all) | **Active** |
| All tasks = ready | **Ready** |
| No state data | **Ready** |

**Progress:** `done / total` tasks with percentage calculation

**See:** `js/systemwide-report.js` (calculateStatus, createProgressBar functions)

---

## ğŸ¨ Table Rendering

**File:** `js/systemwide-report.js`

**Process:**
1. Fetch sessions from `/php/api/list-detailed`
2. Calculate status and progress for each session
3. Sort by timestamp (newest first)
4. Render table rows with: Session key (link), Type, Date, Status badge, Progress
5. Update filter badge counts (sessions with "at least one" matching task)

**Filter Logic:**
- All/Demos: Show text summary (no progress bar), "-" status placeholder
- Ready/Active/Done: Show progress bar + filter-specific icon

**See:** `js/systemwide-report.js` (renderTable, createProgressBar, updateFilterCounts)

---

## ğŸ¯ Filtering System

**Filters:** All, Done, Active, Ready, Demos

**Logic:**
- Shows sessions with "at least one" task matching filter status
- All: Non-demo sessions (text summary, no progress bar)
- Demos: Demo sessions only
- Status filters: Sessions with â‰¥1 matching task (progress bar shown)

**Filter Colors:**
- Ready: Blue (#1a76bb)
- Active: Yellow (#fec111)
- Done: Green (#00834b)
- All/Demos: Black (#333333)

**See:** `js/systemwide-report.js` (handleFilterClick, renderTable)

---

## ğŸ“… Date Formatting

### Implementation

```javascript
function formatDate(timestamp) {
  const date = new Date(timestamp);
  const options = {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  return date.toLocaleDateString('en-US', options);
}

// Example output: "Oct 20, 2025, 01:30 PM"
```

---

## ğŸ¨ Status Badges

**Colors:**
- Done: Green (#4CAF50)
- Active: Yellow (#FFC107)
- Ready: Gray (#9E9E9E)

**See:** `css/systemwide-report.css` for complete styling

---

## ğŸ”— Navigation

### Session Links

Each session key is a clickable link to the detailed list report:

```html
<a href="/list-report?session=${sessionKey}">
  ${sessionKey}
</a>
```

**Destination:** `/list-report?session=A4K` â†’ Detailed single-checklist report

### Header Buttons

- **Refresh** - Reload data from API
- **Home** - Navigate to `/home` (checklist type selection)

---

## âš¡ Performance Optimization

### Client-Side Status Calculation

**Why:** Avoids complex server-side calculations and database queries

**How:**
1. Fetch full state data once (`/php/api/list-detailed`)
2. Calculate status client-side for all sessions
3. Cache results until refresh

**Trade-off:**
- Larger initial payload (includes state data)
- Faster subsequent filtering (no server round-trips)
- Acceptable for typical usage (< 100 sessions)

### Scroll Buffer Optimization

```javascript
// Only update buffer on filter change (not during scroll)
filterButtons.forEach(button => {
  button.addEventListener('click', function() {
    // ... filter logic ...

    // Update scroll buffer after filtering
    window.ScrollManager.scheduleReportBufferUpdate();
  });
});
```

---

## â™¿ Accessibility Features

### ARIA Labels

```html
<div class="filter-buttons" role="group" aria-label="Filter reports by status">
  <button class="filter-button active" data-filter="all" aria-pressed="true">
    All (<span class="count-all">15</span>)
  </button>
</div>
```

### Table Semantics

```html
<table class="reports-table">
  <caption class="reports-caption">All Saved Checklists</caption>
  <thead>
    <tr>
      <th scope="col" class="session-cell">Session</th>
      <!-- ... -->
    </tr>
  </thead>
</table>
```

### Keyboard Navigation

- All filters keyboard accessible (Tab, Enter)
- Session links keyboard accessible
- Focus indicators visible (2px outline)

---

## ğŸ§ª Testing

### Test Coverage

From `proj-test-mirror` (16 systemwide report tests):
- âœ… Page load verification
- âœ… List-detailed API endpoint
- âœ… JavaScript module loading
- âœ… Filter buttons (Done, Active, Ready, All, Demos)
- âœ… Reports table structure
- âœ… Status/Progress columns
- âœ… Refresh and Home buttons
- âœ… CSS file loading
- âœ… Caption and section elements
- âœ… Scroll buffer configuration

### Manual Testing Checklist

1. Load `/systemwide-report`
2. Verify all sessions displayed
3. Test each filter (All, Done, Active, Ready, Demos)
4. Verify counts match filtered rows
5. Click session link â†’ navigates to list report
6. Click Refresh â†’ data reloads
7. Click Home â†’ navigates to home page
8. Test keyboard navigation
9. Test with 0 sessions (empty state)
10. Test with 100+ sessions (performance)

---

## ğŸ“š Related Documentation

- **[GENERAL-ARCHITECTURE.md](GENERAL-ARCHITECTURE.md)** - System overview
- **[SAVE-AND-RESTORE.md](SAVE-AND-RESTORE.md)** - list-detailed API endpoint
- **[LIST-REPORT.md](LIST-REPORT.md)** - Individual checklist reports (linked from this page)
- **[TESTING.md](TESTING.md)** - Systemwide report test coverage
- **[LIST-USER-INTERFACE.md](LIST-USER-INTERFACE.md)** - UI components

---

*Document Created: October 20, 2025*
*Synthesized from: reports-page.md (870 lines)*
*Status: Complete systemwide reporting dashboard documentation*
